name: Delete Old Workflow Runs

on:
  # 1. 定时触发：每月1号的 00:00 (UTC) 运行一次
  schedule:
    - cron: '0 0 1 * *'
  # 2. 手动触发：允许你在 Actions 页面手动点击运行
  workflow_dispatch:

jobs:
  del_runs:
    runs-on: ubuntu-latest
    permissions:
      actions: write
      contents: read

    steps:
      - name: Delete workflow runs
        # 使用社区最成熟的清理 Action
        uses: Mattraks/delete-workflow-runs@v2
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          
          # --- 配置项 ---
          
          # 保留多少天的记录？(超过这个时间的会被删除)
          retain_days: 30
          
          # 最少保留多少个记录？
          # (哪怕所有记录都超过了30天，也会强行保留最后这几个，防止清空)
          keep_minimum_runs: 6
          
          # 是否删除“被跳过(skipped)”或“取消(cancelled)”的记录？
          # delete_workflow_pattern: "Generate Table of Contents" # 如果只想删除特定名字的 Action 可以取消注释这行
